# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: stresschaos
templates:
  - chaos-mesh/stresschaos.yaml
tests:
  - it: should create stresschaos with basic configuration
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          duration: "60s"
          stressors:
            cpu:
              workers: 1
              load: 50
    asserts:
      - isKind:
          of: StressChaos
      - equal:
          path: metadata.name
          value: RELEASE-NAME-kairoscloud-chart-stress-chaos
      - equal:
          path: spec.duration
          value: "60s"
      - equal:
          path: spec.stressors.cpu.workers
          value: 1
      - equal:
          path: spec.stressors.cpu.load
          value: 50

  - it: should create stresschaos with memory stress
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          stressors:
            memory:
              workers: 2
              size: "256MB"
    asserts:
      - equal:
          path: spec.stressors.memory.workers
          value: 2
      - equal:
          path: spec.stressors.memory.size
          value: "256MB"

  - it: should create stresschaos with both cpu and memory stress
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          stressors:
            cpu:
              workers: 1
              load: 80
            memory:
              workers: 1
              size: "512MB"
    asserts:
      - equal:
          path: spec.stressors.cpu.workers
          value: 1
      - equal:
          path: spec.stressors.cpu.load
          value: 80
      - equal:
          path: spec.stressors.memory.workers
          value: 1
      - equal:
          path: spec.stressors.memory.size
          value: "512MB"

  - it: should create stresschaos with custom selector
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          selector:
            namespaces:
              - custom-namespace
            labelSelectors:
              app: test-app
    asserts:
      - equal:
          path: spec.selector.namespaces[0]
          value: custom-namespace
      - equal:
          path: spec.selector.labelSelectors.app
          value: test-app

  - it: should create stresschaos with container name
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          containerName: "main-container"
          percent: 50
    asserts:
      - equal:
          path: spec.containerName
          value: "main-container"
      - equal:
          path: spec.percent
          value: 50

  - it: should create stresschaos with annotations
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: true
          annotations:
            test-annotation: "test-value"
    asserts:
      - equal:
          path: metadata.annotations.test-annotation
          value: "test-value"

  - it: should not create stresschaos when disabled
    set:
      chaosMesh:
        enabled: true
        stressChaos:
          enabled: false
    asserts:
      - isNull:
          path: metadata.name

  - it: should not create stresschaos when chaosMesh disabled
    set:
      chaosMesh:
        enabled: false
    asserts:
      - isNull:
          path: metadata.name
