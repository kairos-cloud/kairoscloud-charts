# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: dnschaos
templates:
  - chaos-mesh/dnschaos.yaml
tests:
  - it: should create dnschaos with basic configuration
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: true
          action: "error"
          duration: "60s"
    asserts:
      - isKind:
          of: DNSChaos
      - equal:
          path: metadata.name
          value: RELEASE-NAME-kairoscloud-chart-dns-chaos
      - equal:
          path: spec.action
          value: "error"
      - equal:
          path: spec.duration
          value: "60s"

  - it: should create dnschaos with custom selector
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: true
          selector:
            namespaces:
              - custom-namespace
            labelSelectors:
              app: test-app
    asserts:
      - equal:
          path: spec.selector.namespaces[0]
          value: custom-namespace
      - equal:
          path: spec.selector.labelSelectors.app
          value: test-app

  - it: should create dnschaos with patterns
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: true
          patterns:
            - "*.example.com"
            - "api.*.com"
    asserts:
      - equal:
          path: spec.patterns[0]
          value: "*.example.com"
      - equal:
          path: spec.patterns[1]
          value: "api.*.com"

  - it: should create dnschaos with container names
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: true
          containerNames:
            - "main-container"
            - "sidecar"
    asserts:
      - equal:
          path: spec.containerNames[0]
          value: "main-container"
      - equal:
          path: spec.containerNames[1]
          value: "sidecar"

  - it: should create dnschaos with annotations
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: true
          annotations:
            test-annotation: "test-value"
    asserts:
      - equal:
          path: metadata.annotations.test-annotation
          value: "test-value"

  - it: should not create dnschaos when disabled
    set:
      chaosMesh:
        enabled: true
        dnsChaos:
          enabled: false
    asserts:
      - isNull:
          path: metadata.name

  - it: should not create dnschaos when chaosMesh disabled
    set:
      chaosMesh:
        enabled: false
    asserts:
      - isNull:
          path: metadata.name
